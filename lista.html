<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Lista - Conecta Serviços</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<nav class="navbar navbar-light bg-light shadow-sm">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">Conecta Serviços</span>
    <div>
      <span id="usuarioEmail" class="me-3"></span>
      <button class="btn btn-outline-danger btn-sm" onclick="logout()">Sair</button>
    </div>
  </div>
</nav>

<div class="container mt-3">
    <button class="btn btn-secondary" onclick="history.back()">
        ← Voltar
    </button>
</div>
    
<div class="container mt-4">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Telefone</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="tabelaColaboradores"></tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<script src="auth.js"></script>

<script>
verificarLogin();

<script>
async function carregar() {
    const { data } = await supabaseClient
        .from("colaboradores")
        .select("*")
        .order("id", { ascending: false });

    const tabela = document.getElementById("tabelaColaboradores");
    tabela.innerHTML = "";

    data.forEach(c => {

        const linkWhats = c.whatsapp 
        ? `<a href="https://wa.me/55${c.whatsapp.replace(/\D/g,'')}" target="_blank">WhatsApp</a>`
        : '-';

        tabela.innerHTML += `
        <tr>
            <td>${c.nome}</td>
            <td>${c.categoria}</td>
            <td>${c.endereco || '-'}</td>
            <td>${c.descricao || '-'}</td>
            <td>${linkWhats}</td>
            <td>⭐ ${c.avaliacao.toFixed(1)}</td>
        </tr>
        `;
    });
}
carregar();
  
async function verificarSessao() {
    const { data: { user } } = await supabaseClient.auth.getUser();

    if (!user) {
        window.location.href = "login.html";
        return;
    }

    if (!user.email_confirmed_at) {
        alert("Confirme seu email antes de acessar o sistema.");
        await supabaseClient.auth.signOut();
        window.location.href = "login.html";
    }
}

verificarSessao();
async function excluir(id){
    if(confirm("Deseja excluir?")){
        await supabaseClient.from("colaboradores").delete().eq("id", id);
        carregar();
    }
}

carregar();
</script>

</body>

</html>






