<script>
verificarLogin();

document.getElementById("formCadastro").addEventListener("submit", async (e) => {
    e.preventDefault();

    const { data: { user } } = await supabaseClient.auth.getUser();

    if (!user) {
        alert("Voc√™ precisa estar logado.");
        return;
    }

    const nome = document.getElementById("nome").value;
    const categoria = document.getElementById("categoria").value;
    const telefone = document.getElementById("telefone").value;
    const whatsapp = document.getElementById("whatsapp").value;
    const endereco = document.getElementById("endereco").value;
    const descricao = document.getElementById("descricao").value;

    // üîç Verifica se j√° existe cadastro
    const { data: existente } = await supabaseClient
        .from("colaboradores")
        .select("id")
        .eq("user_id", user.id)
        .maybeSingle();

    if (existente) {
        alert("Voc√™ j√° possui um cadastro profissional.");
        return;
    }

    // üíæ Faz o INSERT
    await supabaseClient
    .from('colaboradores')
    .insert([{
    nome: nome,
    descricao: descricao,
    endereco: endereco,
    whatsapp: whatsapp,
    categoria: categoria,
    user_id: user.id
    }]);

    if (error) {
        alert("Erro ao criar cadastro.");
        console.log(error);
    } else {
        alert("Cadastro criado com sucesso!");
        window.location.href = "minha-conta.html";
    }
});
</script>
